<!doctype html>
<html class="theme-next use-motion">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>




  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.3.0"/>




	<meta name="keywords" content="iOS," />

  <title> iOS 利用 framework 进行动态更新 // Nix 的自我修养 </title>
</head>

<body>
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
    <a href="/" class="brand">
        <span class="logo">
          <i class="icon-logo"></i>
        </span>
        <span class="site-title">Nix 的自我修养</span>
    </a>
</h1>


  <ul id="menu" class="menu">
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          Home
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          Archives
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          Tags
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
            
          

          <div id="posts" class="posts-expand">
            
  

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              iOS 利用 framework 进行动态更新
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            Posted on 2015-11-08
          
        </span>
        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/11/09/ios-dynamic-update/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/09/ios-dynamic-update/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          <h2 id="前言">前言</h2><p>目前 iOS 上的动态更新方案主要有以下 4 种：</p>
<ul>
<li>HTML 5</li>
<li>lua（wax）hotpatch</li>
<li>react native</li>
<li>framework</li>
</ul>
<p>前面三种都是通过在应用内搭建一个运行环境来实现动态更新（HTML 5 是原生支持），在用户体验、与系统交互上有一定的限制，对开发者的要求也更高（至少得熟悉 lua 或者 js）。</p>
<p>使用 framework 的方式来更新可以不依赖第三方库，使用原生的 OC/Swift 来开发，体验更好，开发成本也更低。</p>
<p>由于 Apple 不希望开发者绕过 App Store 来更新 app，因此<strong>只有对于不需要上架的应用，才能以 framework 的方式实现 app 的更新。</strong></p>
<a id="more"></a>
<h2 id="主要思路">主要思路</h2><p>将 app 中的某个模块（比如一个 tab）的内容独立成一个 framework 的形式动态加载，在 app 的 main bundle 中，当 app 启动时从服务器上下载新版本的 framework 并加载即可达到动态更新的目的。代码放在了<a href="https://github.com/nix1024/DynamicUpdateDemo" target="_blank" rel="external">这里</a>。</p>
<h2 id="实战">实战</h2><p>创建一个普通工程 DynamicUpdateDemo，其包含一个 framework 子工程 Module。也可以将 Module 创建为独立的工程，创建工程的过程不再赘述。</p>
<h3 id="依赖">依赖</h3><p>在主工程的 Build Phases &gt; Target Dependencies 中添加 Module，并且添加一个 New Copy Files Phase。</p>
<p><img src="/images/2015-11-09/New Copy Files Phase.png" alt="New Copy Files Phase"></p>
<p>这样，打包时会将生成的 Module.framework 添加到 main bundle 的根目录下。</p>
<h3 id="加载">加载</h3><p>主要的代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIViewController</span> *)loadFrameworkNamed:(<span class="built_in">NSString</span> *)bundleName &#123;</span><br><span class="line">    <span class="built_in">NSArray</span>* paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, <span class="literal">YES</span>);</span><br><span class="line">    <span class="built_in">NSString</span> *documentDirectory = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> ([paths count] != <span class="number">0</span>) &#123;</span><br><span class="line">        documentDirectory = [paths objectAtIndex:<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSFileManager</span> *manager = [<span class="built_in">NSFileManager</span> defaultManager];</span><br><span class="line">    <span class="built_in">NSString</span> *bundlePath = [documentDirectory stringByAppendingPathComponent:[bundleName stringByAppendingString:<span class="string">@".framework"</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Check if new bundle exists</span></span><br><span class="line">    <span class="keyword">if</span> (![manager fileExistsAtPath:bundlePath]) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"No framework update"</span>);</span><br><span class="line">        bundlePath = [[<span class="built_in">NSBundle</span> mainBundle]</span><br><span class="line">                      pathForResource:bundleName ofType:<span class="string">@"framework"</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check if default bundle exists</span></span><br><span class="line">        <span class="keyword">if</span> (![manager fileExistsAtPath:bundlePath]) &#123;</span><br><span class="line">            UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:<span class="string">@"Oooops"</span> message:<span class="string">@"Framework not found"</span> delegate:<span class="literal">nil</span> cancelButtonTitle:<span class="string">@"OK"</span> otherButtonTitles:<span class="literal">nil</span>, <span class="literal">nil</span>];</span><br><span class="line">            [alertView show];</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Load bundle</span></span><br><span class="line">    <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">NSBundle</span> *frameworkBundle = [<span class="built_in">NSBundle</span> bundleWithPath:bundlePath];</span><br><span class="line">    <span class="keyword">if</span> (frameworkBundle &amp;&amp; [frameworkBundle loadAndReturnError:&amp;error]) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Load framework successfully"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Failed to load framework with err: %@"</span>,error);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Load class</span></span><br><span class="line">    Class PublicAPIClass = NSClassFromString(<span class="string">@"PublicAPI"</span>);</span><br><span class="line">    <span class="keyword">if</span> (!PublicAPIClass) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Unable to load class"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSObject</span> *publicAPIObject = [PublicAPIClass new];</span><br><span class="line">    <span class="keyword">return</span> [publicAPIObject performSelector:<span class="keyword">@selector</span>(mainViewController)];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码先尝试在 Document 目录下寻找更新后的 framework，如果没有找到，再在 main bundle 中寻找默认的 framework。<br>其中的关键是利用 OC 的动态特性 <code>NSClassFromString</code> 和 <code>performSelector</code> 加载 framework 的类并且执行其方法。</p>
<h3 id="framework_和_host_工程资源共用">framework 和 host 工程资源共用</h3><h4 id="第三方库">第三方库</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class XXX <span class="keyword">is</span> implemented <span class="keyword">in</span> both XXX <span class="keyword">and</span> XXX. One <span class="keyword">of</span> the two will be used. Which one <span class="keyword">is</span> <span class="literal">undefined</span>.</span><br></pre></td></tr></table></figure>
<p>这是当 framework 工程和 host 工程链接了相同的第三方库或者类造成的。</p>
<p>为了让打出的 framework 中不包含 host 工程中已包含的三方库（如 cocoapods 工程编译出的 .a 文件），可以这样：</p>
<ul>
<li>删除 <code>Build Phases &gt; Link Binary With Libraries</code> 中的内容（如有）。此时编译会提示三方库中包含的符号找不到。</li>
<li>在 framework 的 <code>Build Settings &gt; Other Linker Flags</code> 添加 <code>-undefined dynamic_lookup</code>。<strong>必须保证 host 工程编译出的二进制文件中包含这些符号。</strong></li>
</ul>
<h4 id="类文件">类文件</h4><p>尝试过在 framework 中引用 host 工程中已有的文件，通过 <code>Build Settings &gt; Header Search Paths</code> 中添加相应的目录，Xcode 在编译的时候可以成功（因为添加了 <code>-undefined dynamic_lookup</code>），并且 Debug 版本是可以正常运行的，但是 Release  版本动态加载时会提示找不到符号：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Error Domain=NSCocoaErrorDomain Code=<span class="number">3588</span> <span class="string">"The bundle “YourFramework” couldn’t be loaded."</span> (dlopen(<span class="regexp">/var/</span>mobile<span class="regexp">/Containers/</span>Bundle<span class="regexp">/Application/</span><span class="number">5691</span>FB75-<span class="number">408</span>A-<span class="number">4</span>D9A-<span class="number">9347</span>-BC7B90D343C1<span class="regexp">/YourApp.app/</span>YourFramework.framework/YourFramework, <span class="number">265</span>): Symbol not <span class="string">found:</span> _OBJC_CLASS_$_BorderedView</span><br><span class="line">	  Referenced <span class="string">from:</span> <span class="regexp">/var/</span>mobile<span class="regexp">/Containers/</span>Bundle<span class="regexp">/Application/</span><span class="number">5691</span>FB75-<span class="number">408</span>A-<span class="number">4</span>D9A-<span class="number">9347</span>-BC7B90D343C1<span class="regexp">/YourApp.app/</span>YourFramework.framework/YourFramework</span><br><span class="line">	  Expected <span class="string">in:</span> flat namespace</span><br><span class="line">	 <span class="keyword">in</span> <span class="regexp">/var/</span>mobile<span class="regexp">/Containers/</span>Bundle<span class="regexp">/Application/</span><span class="number">5691</span>FB75-<span class="number">408</span>A-<span class="number">4</span>D9A-<span class="number">9347</span>-BC7B90D343C1<span class="regexp">/YourApp.app/</span>YourFramework.framework<span class="regexp">/YourFramework) UserInfo=0x174276900 &#123;NSLocalizedFailureReason=The bundle couldn’t be loaded., NSLocalizedRecoverySuggestion=Try reinstalling the bundle., NSFilePath=/</span>var<span class="regexp">/mobile/</span>Containers<span class="regexp">/Bundle/</span>Application<span class="regexp">/5691FB75-408A-4D9A-9347-BC7B90D343C1/</span>YourApp.app<span class="regexp">/YourFramework.framework/</span>YourFramework, NSDebugDescription=dlopen(<span class="regexp">/var/</span>mobile<span class="regexp">/Containers/</span>Bundle<span class="regexp">/Application/</span><span class="number">5691</span>FB75-<span class="number">408</span>A-<span class="number">4</span>D9A-<span class="number">9347</span>-BC7B90D343C1<span class="regexp">/YourApp.app/</span>YourFramework.framework/YourFramework, <span class="number">265</span>): Symbol not <span class="string">found:</span> _OBJC_CLASS_$_BorderedView</span><br><span class="line">	  Referenced <span class="string">from:</span> <span class="regexp">/var/</span>mobile<span class="regexp">/Containers/</span>Bundle<span class="regexp">/Application/</span><span class="number">5691</span>FB75-<span class="number">408</span>A-<span class="number">4</span>D9A-<span class="number">9347</span>-BC7B90D343C1<span class="regexp">/YourApp.app/</span>YourFramework.framework/YourFramework</span><br><span class="line">	  Expected <span class="string">in:</span> flat namespace</span><br><span class="line">	 <span class="keyword">in</span> <span class="regexp">/var/</span>mobile<span class="regexp">/Containers/</span>Bundle<span class="regexp">/Application/</span><span class="number">5691</span>FB75-<span class="number">408</span>A-<span class="number">4</span>D9A-<span class="number">9347</span>-BC7B90D343C1<span class="regexp">/YourApp.app/</span>YourFramework.framework<span class="regexp">/YourFramework, NSBundlePath=/</span>var<span class="regexp">/mobile/</span>Containers<span class="regexp">/Bundle/</span>Application<span class="regexp">/5691FB75-408A-4D9A-9347-BC7B90D343C1/</span>YourApp.app/YourFramework.framework, NSLocalizedDescription=The bundle “YourFramework” couldn’t be loaded.&#125;</span><br></pre></td></tr></table></figure>
<p>因为 Debug 版本暴露了所有自定义类的符号以便于调试，因此你的 framework 可以找到相应的符号，而 Release 版本则不会。</p>
<p>目前能想到的方法只有将相同的文件拷贝一份到 framework 工程里，并且更改类名。</p>
<h3 id="访问_framework_中的图片">访问 framework 中的图片</h3><p>在 storyboard/xib 中可以直接访问图片，代码中访问的方法如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"YourFramework.framework/imageName"</span>]</span><br></pre></td></tr></table></figure>
<p><strong>注意：使用代码方式访问的图片不可以放在 xcassets 中，否则得到的将是 nil。并且文件名必须以 @2x/@3x 结尾，大小写敏感。</strong>因为 <code>imageNamed:</code> 默认在 main bundle 中查找图片。</p>
<h2 id="常见错误">常见错误</h2><h3 id="Architecture">Architecture</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dlopen(<span class="regexp">/path/</span>to/framework, <span class="number">9</span>): no suitable image found.  Did <span class="string">find:</span></span><br><span class="line"><span class="regexp">/path/</span>to/<span class="string">framework:</span> mach-o, but wrong architecture</span><br></pre></td></tr></table></figure>
<p>这是说 framework 不支持当前机器的架构。<br>通过</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lipo -info <span class="regexp">/path/</span>to<span class="regexp">/MyFramework.framework/My</span>Framework</span><br></pre></td></tr></table></figure>
<p>可以查看 framework 支持的 CPU 架构。</p>
<p>碰到这种错误，一般是因为编译 framework 的时候，scheme 选择的是模拟器，应该选择<strong>iOS Device</strong>。</p>
<p>此外，如果没有选择<strong>iOS Device</strong>，编译完成后，Products 目录下的 .framework 文件名会一直是红色，只有在 Derived Data 目录下才能找到编译生成的 .framework 文件。</p>
<h3 id="签名">签名</h3><p><strong>系统在加载动态库时，会检查 framework 的签名，签名中必须包含 TeamIdentifier 并且 framework 和 host app 的 TeamIdentifier 必须一致</strong>。</p>
<p>如果不一致，否则会报下面的错误：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error loading <span class="regexp">/path/</span>to<span class="regexp">/framework: dlopen(/</span>path<span class="regexp">/to/</span>framework, <span class="number">265</span>): no suitable image found. Did <span class="string">find:</span></span><br><span class="line"><span class="regexp">/path/</span>to/<span class="string">framework:</span> mmap() error <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>此外，如果用来打包的证书是 iOS 8 发布之前生成的，则打出的包验证的时候会没有 TeamIdentifier 这一项。这时在加载 framework 的时候会报下面的错误：</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[deny-mmap] <span class="keyword">mapped</span> file <span class="keyword">has</span> no team identifier <span class="keyword">and</span> <span class="keyword">is</span> <span class="keyword">not</span> a <span class="keyword">platform</span> binary:</span><br><span class="line">/<span class="keyword">private</span>/<span class="keyword">var</span>/mobile/Containers/Bundle/Application/<span class="number">5</span>D8FB2F7-<span class="number">1083</span>-<span class="number">4564</span>-<span class="number">94</span>B2-<span class="number">0</span>CB7DC75C9D1/YourAppNameHere.app/Frameworks/YourFramework.framework/YourFramework</span><br></pre></td></tr></table></figure>
<p>可以通过 <code>codesign</code> 命令来验证。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codesign -dv /path/<span class="keyword">to</span>/YourApp.app</span><br></pre></td></tr></table></figure>
<p>如果证书太旧，输出的结果如下：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">Executable=</span>/path/to/YourApp.app/YourApp</span><br><span class="line"><span class="variable">Identifier=</span>com.company.yourapp</span><br><span class="line"><span class="variable">Format=</span>bundle <span class="keyword">with</span> Mach-O thin (armv7)</span><br><span class="line">CodeDirectory <span class="variable">v=</span><span class="number">20100</span> <span class="variable">size=</span><span class="number">221748</span> <span class="variable">flags=</span><span class="number">0</span>x0(none) <span class="variable">hashes=</span><span class="number">11079</span>+<span class="number">5</span> <span class="variable">location=</span>embedded</span><br><span class="line">Signature <span class="variable">size=</span><span class="number">4321</span></span><br><span class="line">Signed <span class="variable">Time=</span><span class="number">2015</span>年<span class="number">10</span>月<span class="number">21</span>日 上午<span class="number">10</span>:<span class="number">18</span>:<span class="number">37</span></span><br><span class="line">Info.plist <span class="variable">entries=</span><span class="number">42</span></span><br><span class="line"><span class="variable">TeamIdentifier=</span>not set</span><br><span class="line">Sealed Resources <span class="variable">version=</span><span class="number">2</span> <span class="variable">rules=</span><span class="number">12</span> <span class="variable">files=</span><span class="number">2451</span></span><br><span class="line">Internal requirements <span class="variable">count=</span><span class="number">1</span> <span class="variable">size=</span><span class="number">188</span></span><br></pre></td></tr></table></figure>
<p>注意其中的 <code>TeamIdentifier=not set</code>。</p>
<p>采用 swift 加载 libswiftCore.dylib 这个动态库的时候也会遇到这个问题，对此<a href="https://developer.apple.com/library/ios/qa/qa1886/_index.html" target="_blank" rel="external">Apple 官方</a>的解释是：</p>
<blockquote>
<p>To correct this problem, you will need to sign your app using code signing certificates with the Subject Organizational Unit (OU) set to your Team ID. All Enterprise and standard iOS developer certificates that are created after iOS 8 was released have the new Team ID field in the proper place to allow Swift language apps to run.</p>
<p> If you are an in-house Enterprise developer you will need to be careful that you do not revoke a distribution certificate that was used to sign an app any one of your Enterprise employees is still using as any apps that were signed with that enterprise distribution certificate will stop working immediately. </p>
</blockquote>
<p><strong>只能通过重新生成证书来解决这个问题。但是 revoke 旧的证书会使所有用户已经安装的，用该证书打包的 app 无法运行。</strong></p>
<p>等等，我们就跪在这里了吗？！</p>
<p>现在企业证书的有效期是三年，当证书过期时，其打包的应用就不能运行，那企业应用怎么来更替证书呢？</p>
<p><strong>Apple 为每个账号提供了两个证书，这两个证书可以同时生效，这样在正在使用的证书过期之前，可以使用另外一个证书打包发布，让用户升级到新版本。</strong></p>
<p>也就是说，可以使用另外一个证书来打包应用，并且可以覆盖安装使用旧证书打包的应用。详情可以看 <a href="https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/AppDistributionGuide/DistributingEnterpriseProgramApps/DistributingEnterpriseProgramApps.html#//apple_ref/doc/uid/TP40012582-CH33-SW1" target="_blank" rel="external">Apple 文档</a>。</p>
<blockquote>
<p>You are responsible for managing your team’s certificates and provisioning profiles. Apple Developer Enterprise Program certificates expire after three years and provisioning profiles expire after one year.</p>
<p>Before a distribution certificate expires, create an additional distribution certificate, described in Creating Additional Enterprise Distribution Certificates. You cannot renew an expired certificate. Instead, replace the expired certificate with the new certificate, described in Replacing Expired Certificates.</p>
<p>If a distribution provisioning profile expires, verify that you have a valid distribution certificate and renew the provisioning profile, described in Renewing Expired Provisioning Profiles.</p>
</blockquote>
<h2 id="参考">参考</h2><p><a href="http://devguo.com/blog/2015/06/16/iosdong-tai-geng-xin-frameworkshi-xian/" target="_blank" rel="external">http://devguo.com/blog/2015/06/16/iosdong-tai-geng-xin-frameworkshi-xian/</a></p>
<p><a href="http://stackoverflow.com/questions/25909870/xcode-6-and-embedded-frameworks-only-supported-in-ios8" target="_blank" rel="external">http://stackoverflow.com/questions/25909870/xcode-6-and-embedded-frameworks-only-supported-in-ios8</a></p>
<p><a href="http://blog.csdn.net/like7xiaoben/article/details/44081257" target="_blank" rel="external">http://blog.csdn.net/like7xiaoben/article/details/44081257</a></p>
<p><a href="https://www.apperian.com/mam-blog/impact-ios-8-app-wrapping/" target="_blank" rel="external">https://www.apperian.com/mam-blog/impact-ios-8-app-wrapping/</a></p>
<p><a href="http://stackoverflow.com/questions/9216485/how-to-manage-enterprise-distribution-certificate-expiration" target="_blank" rel="external">http://stackoverflow.com/questions/9216485/how-to-manage-enterprise-distribution-certificate-expiration</a></p>

        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/ios/">
                #iOS
              </a>
            
          </div>
        

        
          <div class="post-nav">
            <div class="post-nav-prev post-nav-item">
              
            </div>

            <div class="post-nav-next post-nav-item">
              
                <a href="/2015/04/24/symbolicate-crash-log/">Symbolicate iOS Crash Log</a>
              
            </div>
          </div>
        

        
        
      </div>
    
  </div>



  
    <div class="comments" id="comments">
      
        <div id="disqus_thread">
          <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
      
    </div>
  

          </div>

          
        </div>

        
<div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>

<div id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
          Table Of Contents
        </li>
        <li class="sidebar-nav-overview" data-target="site-overview">
          Overview
        </li>
      </ul>
    

    <div class="site-overview">
      <div class="site-author motion-element">
        <img class="site-author-image" src="/images/avatar.jpg" alt="Nix Wang" />
        <p class="site-author-name">Nix Wang</p>
      </div>
      <p class="site-description motion-element"></p>
      <div class="site-state motion-element">
        <div class="site-state-item site-state-posts">
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">posts</span>
        </div>
        <div class="site-state-item site-state-tags">
            <span class="site-state-item-count">19</span>
            <span class="site-state-item-name">tags</span>
        </div>
        <div class="site-state-item site-state-pages">
            <span class="site-state-item-count">1</span>
            <span class="site-state-item-name">pages</span>
        </div>
      </div>

      

      <div class="social-info motion-element">
        
      </div>

      
      
        <div class="cc-license motion-element">
          <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
            <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
          </a>
        </div>
      

    </div>

    
      <div class="post-toc-wrap sidebar-panel-active">
        <div class="post-toc-indicator-top post-toc-indicator"></div>
        <div class="post-toc">
          <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主要思路"><span class="nav-number">2.</span> <span class="nav-text">主要思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实战"><span class="nav-number">3.</span> <span class="nav-text">实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#依赖"><span class="nav-number">3.1.</span> <span class="nav-text">依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#加载"><span class="nav-number">3.2.</span> <span class="nav-text">加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#framework_和_host_工程资源共用"><span class="nav-number">3.3.</span> <span class="nav-text">framework 和 host 工程资源共用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第三方库"><span class="nav-number">3.3.1.</span> <span class="nav-text">第三方库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类文件"><span class="nav-number">3.3.2.</span> <span class="nav-text">类文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#访问_framework_中的图片"><span class="nav-number">3.4.</span> <span class="nav-text">访问 framework 中的图片</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常见错误"><span class="nav-number">4.</span> <span class="nav-text">常见错误</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Architecture"><span class="nav-number">4.1.</span> <span class="nav-text">Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#签名"><span class="nav-number">4.2.</span> <span class="nav-text">签名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">5.</span> <span class="nav-text">参考</span></a></li></ol>
        </div>
        <div class="post-toc-indicator-bottom post-toc-indicator"></div>
      </div>
    

  </div>
</div>


      </div>
    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2013 - 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Nix Wang</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT</a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".fancybox").fancybox();
    });
  </script>

  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }
</script>

  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  

  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    sidebatToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebatToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  
  
<script type="text/javascript" id="bootstrap.scrollspy.custom">
  /* ========================================================================
  * Bootstrap: scrollspy.js v3.3.2
  * http://getbootstrap.com/javascript/#scrollspy
  * ========================================================================
  * Copyright 2011-2015 Twitter, Inc.
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
  * ======================================================================== */

  /**
   * Custom by iissnan
   *
   * - Add a `clear.bs.scrollspy` event.
   * - Esacpe targets selector.
   */


  +function ($) {
    'use strict';

    // SCROLLSPY CLASS DEFINITION
    // ==========================

    function ScrollSpy(element, options) {
      this.$body          = $(document.body)
      this.$scrollElement = $(element).is(document.body) ? $(window) : $(element)
      this.options        = $.extend({}, ScrollSpy.DEFAULTS, options)
      this.selector       = (this.options.target || '') + ' .nav li > a'
      this.offsets        = []
      this.targets        = []
      this.activeTarget   = null
      this.scrollHeight   = 0

      this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this))
      this.refresh()
      this.process()
    }

    ScrollSpy.VERSION  = '3.3.2'

    ScrollSpy.DEFAULTS = {
      offset: 10
    }

    ScrollSpy.prototype.getScrollHeight = function () {
      return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
    }

    ScrollSpy.prototype.refresh = function () {
      var that          = this
      var offsetMethod  = 'offset'
      var offsetBase    = 0

      this.offsets      = []
      this.targets      = []
      this.scrollHeight = this.getScrollHeight()

      if (!$.isWindow(this.$scrollElement[0])) {
        offsetMethod = 'position'
        offsetBase   = this.$scrollElement.scrollTop()
      }

      this.$body
        .find(this.selector)
        .map(function () {
          var $el   = $(this)
          var href  = $el.data('target') || $el.attr('href')
          var $href = /^#./.test(href) && $(escapeSelector(href)) // Need to escape selector.

          return ($href
            && $href.length
            && $href.is(':visible')
            && [[$href[offsetMethod]().top + offsetBase, href]]) || null
        })
        .sort(function (a, b) { return a[0] - b[0] })
        .each(function () {
          that.offsets.push(this[0])
          that.targets.push(this[1])
        })


    }

    ScrollSpy.prototype.process = function () {
      var scrollTop    = this.$scrollElement.scrollTop() + this.options.offset
      var scrollHeight = this.getScrollHeight()
      var maxScroll    = this.options.offset + scrollHeight - this.$scrollElement.height()
      var offsets      = this.offsets
      var targets      = this.targets
      var activeTarget = this.activeTarget
      var i

      if (this.scrollHeight != scrollHeight) {
        this.refresh()
      }

      if (scrollTop >= maxScroll) {
        return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
      }

      if (activeTarget && scrollTop < offsets[0]) {
        $(this.selector).trigger('clear.bs.scrollspy')  // Add a custom event.
        this.activeTarget = null
        return this.clear()
      }

      for (i = offsets.length; i--;) {
        activeTarget != targets[i]
          && scrollTop >= offsets[i]
          && (!offsets[i + 1] || scrollTop <= offsets[i + 1])
          && this.activate(targets[i])
      }
    }

    ScrollSpy.prototype.activate = function (target) {
      this.activeTarget = target

      this.clear()

      var selector = this.selector +
        '[data-target="' + target + '"],' +
        this.selector + '[href="' + target + '"]'

      var active = $(selector)
        .parents('li')
        .addClass('active')

      if (active.parent('.dropdown-menu').length) {
        active = active
          .closest('li.dropdown')
          .addClass('active')
      }

      active.trigger('activate.bs.scrollspy')
    }

    ScrollSpy.prototype.clear = function () {
      $(this.selector)
        .parentsUntil(this.options.target, '.active')
        .removeClass('active')
    }


    // SCROLLSPY PLUGIN DEFINITION
    // ===========================

    function Plugin(option) {
      return this.each(function () {
        var $this   = $(this)
        var data    = $this.data('bs.scrollspy')
        var options = typeof option == 'object' && option

        if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
        if (typeof option == 'string') data[option]()
      })
    }

    var old = $.fn.scrollspy

    $.fn.scrollspy             = Plugin
    $.fn.scrollspy.Constructor = ScrollSpy


    // SCROLLSPY NO CONFLICT
    // =====================

    $.fn.scrollspy.noConflict = function () {
      $.fn.scrollspy = old
      return this
    }


    // SCROLLSPY DATA-API
    // ==================

    $(window).on('load.bs.scrollspy.data-api', function () {
      $('[data-spy="scroll"]').each(function () {
        var $spy = $(this)
        Plugin.call($spy, $spy.data())
      })
    })

  }(jQuery);
</script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      if (false) //($('.post-toc').html().trim().length > 0 && isDesktop()) {
        setTimeout(function () {
          $('.sidebar-toggle').trigger('click');
        }, 800);
      }
    });
  </script>




  

  
  

  

    
      
    

    <script type="text/javascript">
      var disqus_shortname = 'nix1024';
      var disqus_identifier = '2015/11/09/ios-dynamic-update/';
      var disqus_url = 'http://yoursite.com/2015/11/09/ios-dynamic-update/';

      (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
    </script>
  


  
</body>
</html>
