<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>消除引入第三方 Framework 导致的 Warning | Nix 的自我修养</title>
  <meta name="author" content="Nix Wang">
  
  <meta name="description" content="最近在引入了一个 framework 后，在 Generate dSYM 的时候报出了大量的 warning：
1warning: (armv7) /Users/USERNAME/Library/Developer/Xcode/DerivedData/FRAMEWORKNAME-gizpafzckwvhuigzyzdtbpcvryue/Build/Intermediates/FRAMEWORKNAME.build/Debug-iphoneos/FRAMEWORKNAME.build/Objects-normal/armv7/SOMECLASS.o unable to open object file: No such file or directory
在 Xcode 查看编译过程发现是执行 dsymutil 这条命令时产生的。

dsymutil links the DWARF debug information found in the object files for an executable exe_path by using debug symbols information contained in its symbol table.">
  
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="消除引入第三方 Framework 导致的 Warning"/>
  <meta property="og:site_name" content="Nix 的自我修养"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Nix 的自我修养" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div id="page" class="site">
  <div id="primary" class="content-area">

    <header id="header" class="inner"><div class="site-branding">
  <h1 class="site-title">
    <a href="/">Nix 的自我修养</a>
  </h1>
  <p class="site-description"></p>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation">
  <ul>
    
      <li><a href="/">主页</a></li>
    
      <li><a href="/archives">归档</a></li>
    
  </ul>
</nav></header>

    <article id="content" class="site-content">
      <main id="main" class="site-main posts-loop" role="main">
        <article class="post article">

  
  
    <h3 class="article-title"><span>消除引入第三方 Framework 导致的 Warning</span></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2016/05/09/kill-debug-symbol-warnings/" rel="bookmark">
        <time class="entry-date published" datetime="2016-05-09T11:38:07.000Z">
          2016-05-09
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>最近在引入了一个 framework 后，在 Generate dSYM 的时候报出了大量的 warning：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">warning:</span> (armv7) <span class="regexp">/Users/</span>USERNAME<span class="regexp">/Library/</span>Developer<span class="regexp">/Xcode/</span>DerivedData<span class="regexp">/FRAMEWORKNAME-gizpafzckwvhuigzyzdtbpcvryue/</span>Build<span class="regexp">/Intermediates/</span>FRAMEWORKNAME.build<span class="regexp">/Debug-iphoneos/</span>FRAMEWORKNAME.build<span class="regexp">/Objects-normal/</span>armv7/SOMECLASS.o unable to open object <span class="string">file:</span> No such file or directory</span><br></pre></td></tr></table></figure>
<p>在 Xcode 查看编译过程发现是执行 <code>dsymutil</code> 这条命令时产生的。</p>
<blockquote>
<p>dsymutil links the DWARF debug information found in the object files for an executable exe_path by using debug symbols information contained in its symbol table.</p>
</blockquote>
<a id="more"></a>
<p>众所周知，Xcode 编译的时候会处理两种符号：</p>
<ul>
<li>Mach-O 符号：链接器在链接的时候需要处理。</li>
<li>调试符号：顾名思义，在使用调试器调试用到的符号。</li>
</ul>
<p>为了让发行的安装包更小，通常会在编译的时候将调试符号从可执行文件中去掉。这样，在发生 crash 后得到的 crash log 里面只能得到 16 进制的地址。</p>
<p>Xcode 提供了一个编译设置项：<code>Debug Information Format</code>，有两个选项：<code>DWARF</code> 和 <code>DWARF with dSYM File</code>。</p>
<p>其中，<a href="http://dwarfstd.org/" target="_blank" rel="external">DWARF</a> 是一种独立于语言和操作系统的调试文件格式。最初是设计用来配合 ELF（ Executable and Linkable Format，精灵和矮人 :]）工作的。DWARF 不会在可执行文件中包含调试符号，而是仅仅包含对 .o 文件的引用，而这些 .o 文件才真正包含调试符号。</p>
<p>dSYM 是 Xcode 用来存储调试符号的文件，可以用它来符号化 crash log 或者调试程序。</p>
<p>如果 <code>Debug Information Format</code> 设置成了 <code>DWARF with dSYM File</code>，Xcode 在编译结束时会调用 <code>dsymutil</code>，将 .o 中的符号抽出来生成 .dSYM 文件。</p>
<p>（生成 .dSYM 文件需要消耗一定的时间，因为 debug 的时候本地有 .o 文件，可以不需要 .dSYM 文件来 debug，所以最好将 debug 版本的 <code>Debug Information Format</code> 设置成 <code>DWARF</code>。）</p>
<p>回头来看最初的问题。使用</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nm -a <span class="regexp">/path/</span>to<span class="regexp">/foo.framework/</span>foo</span><br></pre></td></tr></table></figure>
<p>来查看所有的符号，其中就包含了</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">000000005704</span>a7a2 - <span class="number">03</span> <span class="number">0001</span>   OSO <span class="regexp">/Users/U</span>SERNAME<span class="regexp">/Library/</span>Developer<span class="regexp">/Xcode/</span>DerivedData<span class="regexp">/VIVerifyCore-gfjrgtjfcqfqpybbcyouhfavymdn/</span>Build<span class="regexp">/Intermediates/</span>FRAMEWORKNAME.build<span class="regexp">/Debug-iphonesimulator/</span>FRAMEWORKNAME.build<span class="regexp">/Objects-normal/</span>armv7<span class="regexp">/SOMECLASS.o</span></span><br></pre></td></tr></table></figure>
<p>由此可见，因为引入的 framework 编译时开启了 <code>Generate Debug Symbols</code>，编译出来的二进制文件包含了对一些 .o 文件的引用。这些 .o 文件是 framework 在编译的过程中产生的，framework 的使用方在执行 <code>dsymutil</code> 时找不到它们，于是产生 warning。</p>
<p>在关闭 <code>Generate Debug Symbols</code> 后重新编译 framework，执行同样的命令，生成的可执行文件中就没有这些引用了。再集成到 App 中，编译就不会有前面提到的 warning。</p>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
          
  

  <span class="post-tags">
    <i class="icon-tags"></i>
    <a href="/tags/ios/">iOS</a>
  </span>


        </div>
        
    </footer>
  </div>
</article>

  
	<section id="comments" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'nix1024';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>





      </main>
    </article>

    <footer id="colophon" class="site-footer" role="contentinfo"><p class="site-info">
  Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
  Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
  </br>
  
  &copy; 2016 Nix Wang
  
</p>
</footer>
    
  </div>
</div>
</body>
</html>